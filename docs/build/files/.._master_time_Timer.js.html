<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>..\master\time\Timer.js - The Foo API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="The Foo API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.2.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/Metadata.html">Metadata</a></li>
            
                <li><a href="..&#x2F;classes/Playhead.html">Playhead</a></li>
            
                <li><a href="..&#x2F;classes/Timeline.html">Timeline</a></li>
            
                <li><a href="..&#x2F;classes/Timer.html">Timer</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/Node.html">Node</a></li>
            
                <li><a href="..&#x2F;modules/smx.html">smx</a></li>
            
                <li><a href="..&#x2F;modules/SMXComputedAttributes.html">SMXComputedAttributes</a></li>
            
                <li><a href="..&#x2F;modules/SMXCoreAttributes.html">SMXCoreAttributes</a></li>
            
                <li><a href="..&#x2F;modules/SMXNode.html">SMXNode</a></li>
            
                <li><a href="..&#x2F;modules/TimeAttrController
Plugin Controller for attributes namespace with &#x27;ui&#x27;.html">TimeAttrController
Plugin Controller for attributes namespace with &#x27;ui&#x27;</a></li>
            
                <li><a href="..&#x2F;modules/Track Attributes.html">Track Attributes</a></li>
            
                <li><a href="..&#x2F;modules/UIAttrController
Plugin Controller for attributes namespaced with &#x27;ui-&#x27;.html">UIAttrController
Plugin Controller for attributes namespaced with &#x27;ui-&#x27;</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ..\master\time\Timer.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
* Timer Controller
*
* @class Timer
* @constructor
*&#x2F;

(function(){


	var SMXTimer = function(){

		_.extend(this, Backbone.Events);

		&#x2F;&#x2F;interval time
		this.fps = 16; &#x2F;&#x2F; [ 16 | 24 | 32 | 48 | 64 ... ] higher value may push performance limits (not recommended)
		
		&#x2F;&#x2F;timer engine
		this.engine = null;
		
		&#x2F;&#x2F;external engine
		this.extEngines = [];
		
		&#x2F;&#x2F;time counter
		this.time = 0;
		
		&#x2F;&#x2F;time flag
		this.time_flag = null;
		
		&#x2F;&#x2F;loop enabled or not
		this.paused = true;

		&#x2F;&#x2F;requestAnimationFrame?
		this.rAF = false;

		&#x2F;&#x2F;speed
		this.factor = 1;

		this.start = function(){
		
			&#x2F;&#x2F;prevents duplicated runs
			if (this.engine) this.stop();
			
			&#x2F;&#x2F;set time_flag
			this.time_flag = new Date().getTime();
			
			&#x2F;&#x2F;activate loop
			this.paused = false;
			
			&#x2F;&#x2F;set timeout
			if (this.rAF) this.engine = window.requestAnimationFrame( _.bind(this.update,this) );
			else this.engine = setTimeout( _.bind(this.update,this), 1000&#x2F;this.fps );

		};
		
		
		this.plugExtEngine = function(engineId, engine_callback){
		
			&#x2F;&#x2F;engine_callback must be a function returning current time in ms
			this.extEngines.unshift({&#x27;id&#x27;: engineId, &#x27;callback&#x27;: engine_callback});

			return;
		
		};
		
		this.unplugExtEngine = function(engineId){
		
			var found_at_index = -1;
			for (var i=0; i&lt; this.extEngines.length; i++){
				if(this.extEngines[i].id==engineId){
					this.extEngines[i] = null;
					found_at_index = i;
				}
			}
			if(found_at_index&gt;=0){
				this.extEngines.splice(found_at_index,1);
			}

			if (this.extEngines.length==0 &amp;&amp; !this.paused) this.start();
			
			return;
		
		};
		
		this.update = function(time,timerId){
		
			&#x2F;&#x2F;using internal engine &#x27;update&#x27; recives 0 parameters
			&#x2F;&#x2F;and use new Date().getTime() to calculate time ellapsed since last update

			&#x2F;&#x2F;external engines callback must recive 2 param
			&#x2F;&#x2F;time: target time
			&#x2F;&#x2F;timerId: id of a registered external engine
			&#x2F;&#x2F;only registered engines via &#x27;plugExtEngine&#x27; method take effect
			&#x2F;&#x2F;if timerId is not found time param will be ignored and will exit silently

			if (typeof time != &#x27;undefined&#x27; &amp;&amp; typeof timerId != &#x27;undefined&#x27;){

				&#x2F;&#x2F;multiple external engines are not supported
				&#x2F;&#x2F;so, always take only the first extEngine and ignore the others
				if (this.extEngines[0].id == timerId){

					&#x2F;&#x2F;update using param provided by external engine
					this.time = time;
					&#x2F;&#x2F;debug.log(&#x27;TIMER - timer:&#x27;+ parseInt(this.time) +&#x27; from externalEngine:&#x27;+this.extEngines[0].id);
				
					&#x2F;&#x2F;notify update and exit
					this.trigger(&#x27;update&#x27;);
					return;

				}
				else{

					&#x2F;&#x2F;timerId not found, exit silently
					return;
				}

			}

			&#x2F;&#x2F;calculate time ellapsed since last update
			var time_now = new Date().getTime();
			var time_offset = (this.time_flag!=null)? time_now - this.time_flag : 0;
			this.time_flag = time_now;


			&#x2F;&#x2F;calculate real fps
			&#x2F;&#x2F;var fps = 1000&#x2F;time_offset;

			&#x2F;&#x2F;update time
			this.time+=time_offset*this.factor;	
			&#x2F;&#x2F;debug.log(&#x27;TIMER - timer:&#x27;+ parseInt(this.time) +&#x27; from internal engine&#x27;);


			&#x2F;&#x2F;set timeout to next frame
			if (!this.paused &amp;&amp; this.extEngines.length==0){
				if (this.rAF) this.engine = window.requestAnimationFrame( _.bind(this.update,this) );
				else this.engine = setTimeout( _.bind(this.update,this), 1000&#x2F;this.fps );
			}

			&#x2F;&#x2F;notify update and exit
			this.trigger(&#x27;update&#x27;);

			return;

		};
		
		
		this.setTime = function(t){
		
			this.time = t;
			
			&#x2F;&#x2F;notify update
			this.trigger(&#x27;update&#x27;);


		};

		this.stop = function(){
		
			&#x2F;&#x2F;reset timeout
			if (this.engine){
				if (this.rAF) window.cancelAnimationFrame(this.engine);
				else clearTimeout(this.engine);
				this.engine = null;
			}
			
			&#x2F;&#x2F;reset time_flag
			this.time_flag = null;
			
			&#x2F;&#x2F;deactivate update loop
			this.paused = true;
			
			return;

		};
		
		this.reset = function(){
		
			this.stop();
			this.time = 0;

		};
		
		this.destroy = function(){

			&#x2F;&#x2F;kill loop process
			this.stop();

			&#x2F;&#x2F;clear extEngines
			this.extEngines = [];

			return;
		};
		

		return this;
		
	};

	&#x2F;&#x2F;expose 

	window.smx.time.Timer = SMXTimer;

})(window.smx);
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
