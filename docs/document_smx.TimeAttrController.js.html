<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: <small>Source: </small>document/smx.TimeAttrController.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--<link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="styles/tranquil-heart.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
</head>

<body>

<nav>
  <h2><a href="index.html">smx</a></h2><h3>Namespaces</h3><ul><li><a href="$smx.html">$smx</a></li><li><a href="smx.html">smx</a></li><li><a href="smx.AttributeParsers.html">smx.AttributeParsers</a></li><li><a href="smx.NodeParsers.html">smx.NodeParsers</a></li><li><a href="smx.fn.html">smx.fn</a></li><li><a href="smx.time.html">smx.time</a></li><li><a href="smx.tracking.html">smx.tracking</a></li><li><a href="smx.tracking.attributes.html">smx.tracking.attributes</a></li></ul><h3>Classes</h3><ul><li><a href="Compiler.html">Compiler</a></li><li><a href="Loader.html">Loader</a></li><li><a href="Metadata.html">Metadata</a></li><li><a href="smx.Document.html">Document</a></li><li><a href="smx.Finder.html">Finder</a></li><li><a href="smx.Node.html">Node</a></li><li><a href="smx.Playhead.html">Playhead</a></li><li><a href="smx.PlayheadEvent.html">PlayheadEvent</a></li><li><a href="smx.time.Timeline.html">Timeline</a></li><li><a href="smx.time.TimelineEvent.html">TimelineEvent</a></li><li><a href="smx.time.Timer.html">Timer</a></li><li><a href="smx.tracking.TrackManager.html">TrackManager</a></li></ul><h3>Modules</h3><ul><li><a href="module-Node_Metadata.html">Node/Metadata</a></li><li><a href="module-Node_Time.html">Node/Time</a></li><li><a href="module-Node_Tracking.html">Node/Tracking</a></li><li><a href="module-Node_UI.html">Node/UI</a></li><li><a href="module-TimeAttrController.html">TimeAttrController</a></li><li><a href="module-UIAttrController.html">UIAttrController</a></li></ul><h3>Mixins</h3><ul><li><a href="TimeAttributeParser.html">TimeAttributeParser</a></li><li><a href="smx.fn.AttributeGetters.html">AttributeGetters</a></li><li><a href="smx.fn.Core.html">Core</a></li><li><a href="smx.fn.TreeNode.html">TreeNode</a></li></ul>

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on 2018-01-23T23:24:31.960Z
  </footer>
</nav>

<div id="main">

    <h1 class="page-title"><small>Source: </small>document/smx.TimeAttrController.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>(function(smx){
 


    /**
     *  TIME ATTR CONTROLLER
     *  Plugin Controller for attributes namespace with 'ui'
     *  @module TimeAttrController
     */



    var TimeAttrController = {


        'getters': {

            'timeline': function(node){
                return (node.attr('timeline')==='true');
            },

            'timed': function(node){

                var is_in_timeline = false;
                var is_timeline = this.timeline(node);

                if(is_timeline) return false;
                else{
                    var parent = node.parent();
                    while(parent &amp;&amp; !this.timeline(parent)){
                        parent = parent.parent();
                    }

                    if(!parent) return false;
                    else if(this.timeline(parent)) return true;
                    else return false;
                }

            },

            'timing': function(node){
                return (node.attr('timing')==='absolute')? 'absolute': 'relative';
            },

            'duration': function(node, force_sync){

               //use local value if already exists...
                if (!force_sync &amp;&amp; _.isNumber(node.duration)) return node.duration;

                //has duration attribute?
                var duration = parseInt(node.attr('duration'));
                if(_.isNaN(duration) || duration&lt;0) duration = NaN;

                //sync start for
                var start = this.start(node);

                //try child summatory
                if (_.isNaN(duration)){
                    var childs = node.children();
                    childs = childs.reverse();
                    if(childs.length>0){
                        // childs will define duration using
                        // the child with the highest offset+duration value
                        var max = 0;
                        for(var n=0; n&lt;childs.length;n++){
                            var child = childs[n];
                            var sum = this.offset(child) + this.duration(child,force_sync);
                            if(sum>max) max = sum;
                        }
                        duration = max;
                    }
                    else if(!node.next() &amp;&amp; !node.previous()){
                        duration = 0;
                    }
                }

                
                //check next sibling dependencies
                if (_.isNaN(duration) &amp;&amp; this.timed(node)){

                    //get parent
                    var parent = node.parent();

                    if(parent &amp;&amp; _.isNumber(parent.duration)){

                        //get next sibling with absolute timing
                        var next = node.next();
                        var target = null;
                        while(next &amp;&amp; !target){
                            if(this.timing(next) == 'absolute') target = next;
                            else                                next = next.next();
                        }

                        if(target){
                            if (_.isNumber(target.start) &amp;&amp; _.isNumber(node.start)){
                                duration = parseInt(this.offset(next)-node.start);
                                if(_.isNaN(duration) || duration&lt;0) duration=NaN;
                            }
                        }
                        else{
                            duration = parseInt(this.duration(parent)-node.start);
                            if(_.isNaN(duration) || duration&lt;0) duration=NaN;
                        }
                    }
                    else{
                        duration = NaN;
                    }

                }

                if (_.isNaN(duration) &amp;&amp; !this.timed(node)){
                    duration = 0;
                }

                //could not determine duration? set to 0
                if(_.isNaN(duration)){
                    duration = 0;
                }
                else{
                    //create sync flag attribute
                    node[0].setAttribute('is-sync','true');
                }

                //set local value
                node.duration = duration;

                //return local value
                return node.duration;


            },

            'start': function(node, force_sync){

                var start;

                //bool flag use or not local value if exists
                if (!force_sync){

                    //has local value?
                    start = node.attr('start');
                    if(_.isNumber(start)) return start;

                }

                //get it from attribute
                start = parseInt(node.attr('start'));
                if(_.isNaN(start) || start&lt;0) start = 0;

                //set local value
                node.start = start;

                //return local value
                return start;

            },

            'offset': function(node, from){

                var offset = 0;
                var timing = this.timing(node);

                var start = this.start(node);
               
                if(timing == 'absolute'){
                //absolute timing
                //depends on parent node

                    offset = start;

                }else{
                //relative timing
                //depends on previous sibling node

                    var prev = node.previous();

                    if(prev)    offset = this.offset(prev) + this.duration(prev) + start;
                    else        offset = start;
                   
                }

                if (!from) return offset;

                if(!from.isParentOf(node)) offset = -1;
                else{

                    var parent = node.parent();
                    if(!parent) offset = -1;
                    /////????????????????????????
                    else if(parent!=from) offset = this.offset(parent,from) + offset;
               
                }
 
                return offset;

            },

            'end': function(node){
               return this.start(node) + this.duration(node);
            }

        },


        'get': function(node,key){

            if (_.isFunction(this.getters[key])){
                return this.getters[key](node);
            }
            else
                return;

        }



    };





    //expose into global smx namespace
    smx.TimeAttrController = TimeAttrController;



})(window.smx);</code></pre>
        </article>
    </section>




</div>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
